version: "3"

silent: true

includes:
  lint:
    taskfile: https://raw.githubusercontent.com/werf/common-ci/refs/heads/main/Taskfile.format_lint.yml
    flatten: true
    vars:
      paths: "."
  deps:
    taskfile: https://raw.githubusercontent.com/werf/common-ci/refs/heads/main/Taskfile.deps.yml
    flatten: true

tasks:
  sign:
    desc: 'Sign last version tag + origin/main and push signatures. Important vars: "refs".'
    cmds:
      - git fetch --tags -f
      - git signatures pull {{.CLI_ARGS}}
      - |
        for ref in {{.refs | default "$(git tag --sort=v:refname | tail -n1) origin/main origin/trdl"}}; do
          echo Signing $ref...
          git signatures add {{.CLI_ARGS}} $ref
          git signatures show {{.CLI_ARGS}} $ref
        done
      - git signatures push {{.CLI_ARGS}}

  build:
    desc: "Build kubedog binary file"
    cmd: go build github.com/werf/kubedog/cmd/kubedog

  install:
    desc: "Install kubedog"
    cmd: go install github.com/werf/kubedog/cmd/kubedog
